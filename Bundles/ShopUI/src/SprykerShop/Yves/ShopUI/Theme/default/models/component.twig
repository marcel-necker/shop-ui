
{#
 #
 #
 # Component API
 # 
 # @important: use components with 'only' keyword 
 # and limit the scope to what you pass through config and data interface
 #}

{%- set defaultConfig = {
    name: '',
    tag: 'div',
    selector: '',
    debug: false
} -%}

{% block implementation %}
    {%- set config = defaultConfig | merge(config | default({})) -%}
    {%- set config = config | merge({
        selector: config.selector | default(config.name is empty ? defaultConfig.selector : 'js-' ~ config.name)
    }) -%}
    {%- set class = class | default('') -%}
    {%- set modifiers = modifiers | default([]) -%}
    {%- set attributes = attributes | default({}) -%}
    {%- set data = data | default({}) -%}
    {%- set embed = embed | default({}) -%}

    {#
     #
     #
     # Component blocks
     #}

    {%- if config.debug -%}
        {# create 'class', 'selector' and 'attr' blocks #}
        {# to use them: {{ block('blockname') }} #}

        {# render BEM classes (block and modifiers) according to the name #}
        {%- block renderClass -%}
            {%- if config.name == config.tag %}custom-element {% endif -%}
            {{config.name-}} 
            {%- for modifier in modifiers %} {{config.name}}--{{modifier}}{% endfor -%}
            {%- if class %} {{class-}}{% endif -%}
        {%- endblock -%}

        {# render html5 attributes #}
        {%- block renderAttributes -%}
            {%- for attrname, attrvalue in attributes -%}
                {%- if attrvalue is sameas(true) -%}
                    {{-' ' ~ attrname-}}
                {%- elseif attrvalue is not sameas(false) -%}
                    {{-' ' ~ attrname-}}='{{-attrvalue-}}'
                {%- endif -%}
            {%- endfor -%}
        {%- endblock -%}
    {%- endif -%}

    {#
     #
     #
     # Component
     #}

    {%- block component -%}
        <{{-config.tag}} 
            class="{%- block class %}{{block('renderClass')}}{%- endblock -%}"
            {%- block attributes %} {{block('renderAttributes')}}{%- endblock -%}>
            {%- block body -%}{%- endblock -%}
        </{{-config.tag-}}>
    {%- endblock -%}
{% endblock -%}
